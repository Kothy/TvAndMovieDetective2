package com.example.klaud.pocasie;

import android.app.SearchManager;
import android.content.Context;
import android.content.Intent;
import android.graphics.Color;
import android.os.AsyncTask;
import android.os.Bundle;
import android.os.Looper;
import android.support.constraint.ConstraintLayout;
import android.support.design.widget.FloatingActionButton;
import android.support.design.widget.Snackbar;
import android.support.v7.app.AppCompatActivity;
import android.support.v7.widget.Toolbar;
import android.util.Log;
import android.view.Gravity;
import android.view.Menu;
import android.view.View;
import android.widget.Button;
import android.widget.ImageView;
import android.widget.RelativeLayout;
import android.widget.SearchView;
import android.widget.TextView;
import android.widget.Toast;

import com.bumptech.glide.Glide;

import org.apache.http.HttpResponse;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.impl.client.DefaultHttpClient;
import org.json.JSONException;
import org.json.JSONObject;

import java.io.BufferedReader;
import java.io.InputStreamReader;
import java.net.URI;
import java.sql.Timestamp;
import java.util.ArrayList;
import java.util.HashMap;

public class DisplayWeather extends AppCompatActivity {
    Button next,prev;
    Integer index;
    ImageView icon;
    ConstraintLayout layout;
    Days day;
    TextView stupne, minTemp,maxTemp,datum,city;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_display_weather);
        Toolbar toolbar = (Toolbar) findViewById(R.id.toolbar);
        setSupportActionBar(toolbar);
        /*toolbar.setNavigationIcon(R.drawable.ic_arrow_back_black_24dp);
        toolbar.setNavigationOnClickListener(click -> {
            startActivity(new Intent(this, MainActivity.class));
        });*/
        layout=(ConstraintLayout)findViewById(R.id.layout);
        //layout.setBackgroundColor(Color.parseColor("#4286f4"));
        layout.setBackgroundResource(R.drawable.clea);
        icon=findViewById(R.id.imageView);
        minTemp=findViewById(R.id.min);
        maxTemp=findViewById(R.id.max);
        stupne=findViewById(R.id.stupne);
        datum=findViewById(R.id.datum);
        prev=findViewById(R.id.button3);
        next=findViewById(R.id.button4);
        city=findViewById(R.id.city);
        index=0;
        //state.setImageResource(R.drawable.back);
        prev.setOnClickListener((View click)->{
            index--;
            if (index<0)index=4;
            displayDay(index);
        });
        next.setOnClickListener((View click)->{
            index++;
            if (index==5) index=0;
            displayDay(index);
        });
        Intent intent = getIntent();
        if (Intent.ACTION_SEARCH.equals(intent.getAction())) {
            String query = intent.getStringExtra(SearchManager.QUERY);
            //Toast.makeText(this, query, Toast.LENGTH_LONG).show();
            index=0;
            download.execute(query);
        }
        download.execute("Galanta");
    }
    @Override
    public boolean onCreateOptionsMenu(Menu menu) {
        getMenuInflater().inflate(R.menu.menu_main, menu);
        SearchManager searchManager = (SearchManager) getSystemService(Context.SEARCH_SERVICE);
        SearchView searchView = (SearchView) menu.findItem(R.id.search).getActionView();
        searchView.setSearchableInfo(searchManager.getSearchableInfo(getComponentName()));
        return true;
    }
    public void displayDay(Integer ind){
        setTitle(day.getCity());
        String date=day.getDt(ind).substring(0,10);
        String y=date.substring(0,4);
        String m=date.substring(5,7);
        String d=date.substring(8);
        datum.setText(d+" "+getMonth(m)+" "+y);
        minTemp.setText(day.getMinTemp(ind)+"°");
        maxTemp.setText(+day.getMaxTemp(ind)+"°");
        stupne.setText(day.getTemp(ind)+"°");
        city.setText(day.getCity());
        String state=day.getWeather(ind);
        //getResources().getColor(R.color.bgBlue);
        Toast.makeText(this, state, Toast.LENGTH_SHORT).show();
        if (state.contains("thunderstorm")) {

            icon.setBackgroundResource(R.drawable.storm);
        }
        else if (state.contains("drizzle") || state.contains("rain")) {
            icon.setB